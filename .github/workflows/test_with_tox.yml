---
name: check

on:
    push:
        branches:
        -   main
    pull_request:
        branches:
        -   '*'

concurrency:
    group: check-${{ github.ref }}
    cancel-in-progress: true

jobs:
    test_latest:
        name: test with ${{ matrix.py }} on ${{ matrix.os }}
        runs-on: ${{ matrix.os }}
        strategy:
            fail-fast: false
            matrix:
                py:
                -   '3.12'
                -   '3.11'
                -   '3.10'
                -   '3.9'
                -   '3.8'
                os:
                -   ubuntu-latest
                -   macos-latest
                -   windows-latest
        steps:
        -   uses: actions/checkout@v4
        -   name: Setup python for test ${{ matrix.py }}
            uses: actions/setup-python@v4
            with:
                python-version: ${{ matrix.py }}
        -   name: Install tox
            run: python -m pip install tox
        -   name: Test doc
            run: tox run -e test_doc
        -   name: Run test suite
            run: tox run -e test_plotting
        -   name: Upload coverage to CodeCov
            uses: codecov/codecov-action@v3
            if: success()

    prerelease:
        name: Test pre release versions of dependencies
        runs-on: ubuntu-latest
        steps:
        -   uses: actions/checkout@v4
        -   name: Setup python
            uses: actions/setup-python@v4
            with:
                python-version: '3.12'
        -   name: Install tox
            run: python -m pip install tox
        -   name: Run test suite
            run: tox run -e test_pre

    min_requirements:
        name: Python 3.7, minimal requirements with Matplotlib
        runs-on: ubuntu-latest
        steps:
        -   uses: actions/checkout@v4
        -   name: Setup python
            uses: actions/setup-python@v4
            with:
                python-version: '3.7'
        -   name: Install tox
            run: python -m pip install tox
        -   name: Run test suite
            run: tox run -e test_min

    min_requirements_matplotlib:
        name: Python 3.7, minimal requirements with Matplotlib
        runs-on: ubuntu-latest
        steps:
        -   uses: actions/checkout@v4
        -   name: Setup python
            uses: actions/setup-python@v4
            with:
                python-version: '3.7'
        -   name: Install tox
            run: python -m pip install tox
        -   name: Run test suite
            run: tox run -e test_plot_min
